<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>CustomerManager.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lf2u</a> &gt; <a href="index.source.html" class="el_package">org.huzair.use_cases</a> &gt; <span class="el_source">CustomerManager.java</span></div><h1>CustomerManager.java</h1><pre class="source lang-java linenums">package org.huzair.use_cases;

import java.text.DateFormat;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Date;
import java.util.Iterator;
import java.util.Map;
import java.util.concurrent.atomic.AtomicInteger;
import org.huzair.boundary_interfaces.CustomerBI;
import org.huzair.boundary_interfaces.FarmerBI;
import org.huzair.entities.Customer;
import org.huzair.entities.Farmer;
import org.huzair.entities.Order;
import org.huzair.entities.OrderDetail;
import org.huzair.report.OrderReport;

<span class="fc" id="L19">public class CustomerManager implements CustomerBI{</span>

<span class="fc" id="L21">	private static AtomicInteger atomicInteger = new AtomicInteger();</span>
<span class="fc" id="L22">	private static AtomicInteger orderAtomicInteger = new AtomicInteger();</span>
<span class="fc" id="L23">	private static ArrayList&lt;Customer&gt; customers = new ArrayList&lt;Customer&gt;();</span>
<span class="fc" id="L24">	private static ArrayList&lt;Order&gt; orders = new ArrayList&lt;Order&gt;();</span>
<span class="fc" id="L25">	DateFormat dateFormat = new SimpleDateFormat(&quot;yyyyMMdd&quot;);</span>
<span class="fc" id="L26">	FarmerBI FBi = new FarmerManager();</span>
<span class="fc" id="L27">	private String cancel = &quot;cancelled&quot;;</span>
	
	//Creates an account for the customer and returns the customer id
	@Override
	public String createAccount(Customer c) {
<span class="fc" id="L32">		Customer cust = c;</span>
<span class="fc" id="L33">		cust.setCid(Integer.toString(atomicInteger.incrementAndGet()));</span>
<span class="fc" id="L34">		customers.add(cust);</span>
<span class="fc" id="L35">		String cid_as_str = cust.getCid();</span>
<span class="fc" id="L36">		return cid_as_str;</span>
	}
	
	//updates the customer account if found by customer id
	@Override
	public void updateAccount(String cid, Customer c) {
<span class="fc" id="L42">		Customer cust = getCustomerById(cid);</span>
<span class="fc bfc" id="L43" title="All 2 branches covered.">		if(cust!=null)</span>
<span class="fc" id="L44">			cust.setCustomer(c);</span>
		
<span class="fc" id="L46">	}</span>
	
	//Searches customer by id
	public Customer getCustomerById(String cid){
<span class="fc" id="L50">		Iterator&lt;Customer&gt; c = customers.listIterator();</span>
<span class="fc bfc" id="L51" title="All 2 branches covered.">        while(c.hasNext()) {</span>
<span class="fc" id="L52">            Customer customer = c.next();</span>
<span class="fc bfc" id="L53" title="All 2 branches covered.">            if(customer.matchesId(cid))</span>
<span class="fc" id="L54">            	return customer;</span>
<span class="fc" id="L55">        }</span>
<span class="fc" id="L56">		return null;</span>
	}

	//Returns customer account by id
	@Override
	public Customer viewAccount(String cid) {
<span class="fc" id="L62">		Customer customer = getCustomerById(cid);</span>
<span class="fc" id="L63">			return customer;</span>
	}

	//Creates an order if the customer id is found and returns the order id
	@Override
	public String createOrder(String cid, Order o) {
<span class="fc" id="L69">		Customer c = getCustomerById(cid);</span>
<span class="fc bfc" id="L70" title="All 2 branches covered.">		if(c==null)</span>
<span class="fc" id="L71">			return null;</span>
<span class="fc" id="L72">		Farmer farm = FBi.viewAccount(o.getFid());</span>
<span class="fc bfc" id="L73" title="All 2 branches covered.">		if(farm==null)</span>
<span class="fc" id="L74">			return &quot;0&quot;;</span>
<span class="fc" id="L75">		ArrayList&lt;String&gt; zipcodes = farm.getDeliversTo();</span>
<span class="pc bpc" id="L76" title="1 of 2 branches missed.">		if(!zipcodes.contains(c.getZip()))</span>
<span class="nc" id="L77">			return &quot;0&quot;;</span>
		
<span class="fc" id="L79">		Order order = new Order(o);</span>
<span class="fc" id="L80">		order.setCid(cid);</span>
<span class="fc" id="L81">		order.setOid(Integer.toString(orderAtomicInteger.incrementAndGet()));</span>
<span class="fc" id="L82">		order.setStatus(&quot;open&quot;);</span>
<span class="fc" id="L83">		Calendar.getInstance().add(Calendar.DAY_OF_MONTH, 0);</span>
<span class="fc" id="L84">		Date today = Calendar.getInstance().getTime();</span>
<span class="fc" id="L85">		order.setOrder_date(dateFormat.format(today));</span>
<span class="fc" id="L86">		double total = 0;</span>
<span class="fc" id="L87">		Map&lt;String,Double&gt; hashmap = FBi.getHashmap();</span>
		
<span class="fc" id="L89">		ArrayList&lt;OrderDetail&gt; details = order.getAllDetails();</span>
<span class="fc" id="L90">		Iterator&lt;OrderDetail&gt; od = details.listIterator();</span>
<span class="fc bfc" id="L91" title="All 2 branches covered.">        while(od.hasNext()) {</span>
<span class="fc" id="L92">            OrderDetail odetails = od.next();</span>
<span class="fc" id="L93">            double price = 0;</span>
<span class="pc bpc" id="L94" title="1 of 2 branches missed.">            if(odetails!=null){</span>
            	try{
<span class="fc" id="L96">            	price = hashmap.get(odetails.getFspid());</span>
            	}
<span class="pc" id="L98">            	catch(Exception e){}</span>
<span class="fc" id="L99">            	odetails.setPrice(price);</span>
            }
<span class="fc" id="L101">        }</span>
           /*A ArrayList&lt;StoreProduct&gt; sproducts = FBi.viewStore(order.getFid());
    		Iterator&lt;StoreProduct&gt; s = sproducts.listIterator();
            while(s.hasNext()) {
                StoreProduct product = s.next();
                if(odetails.getFspid()==product.getFspid()){
                	odetails.setPrice(product.getPrice());
                	total = total+odetails.getLineItemTotal();
                }
            }  */
        //}
<span class="fc" id="L112">        order.setProductTotal(total);</span>
<span class="fc" id="L113">        order.setAllDetails(details);</span>
<span class="fc" id="L114">		orders.add(order);</span>
<span class="fc" id="L115">		String oid_as_str = order.getOid();</span>
<span class="fc" id="L116">		return oid_as_str;</span>
	}
	
	//Returns all orders by customer id
	@Override
	public ArrayList&lt;Order&gt; viewAllOrders(String cid) {
<span class="fc" id="L122">		ArrayList&lt;Order&gt; allorders = new ArrayList&lt;Order&gt;();</span>
<span class="fc" id="L123">		Customer cust = getCustomerById(cid);</span>
<span class="fc bfc" id="L124" title="All 2 branches covered.">		if(cust==null)</span>
<span class="fc" id="L125">			return null;</span>
<span class="fc" id="L126">		Iterator&lt;Order&gt; o = orders.listIterator();</span>
<span class="fc bfc" id="L127" title="All 2 branches covered.">        while(o.hasNext()) {</span>
<span class="fc" id="L128">            Order order = o.next();</span>
<span class="fc" id="L129">            String order_cid = order.getCid();</span>
<span class="pc bpc" id="L130" title="1 of 2 branches missed.">            if(order_cid.equalsIgnoreCase(cid))</span>
<span class="fc" id="L131">            	allorders.add(order);</span>
<span class="fc" id="L132">        }</span>
<span class="fc" id="L133">		return allorders;</span>
	}
	
	//Searches order by order id
	@Override
	public Order viewById(String oid) {
<span class="fc" id="L139">		Iterator&lt;Order&gt; o = orders.listIterator();</span>
<span class="fc bfc" id="L140" title="All 2 branches covered.">        while(o.hasNext()) {</span>
<span class="fc" id="L141">            Order order = o.next();</span>
<span class="fc bfc" id="L142" title="All 2 branches covered.">            if(order.matchesId(oid))</span>
<span class="fc" id="L143">            	return order;</span>
<span class="fc" id="L144">        }</span>
<span class="fc" id="L145">		return null;</span>
	}
	
	//Cancels order using order and customer id if instruction is &quot;cancelled&quot;
	@Override
	public void cancelOrder(String cid, String oid, String status) {
<span class="pc bpc" id="L151" title="1 of 2 branches missed.">		if(status.equalsIgnoreCase(cancel)){</span>
<span class="fc" id="L152">			ArrayList&lt;Order&gt; all_orders = viewAllOrders(cid);</span>
<span class="fc" id="L153">			Order order = viewById(oid);</span>
<span class="pc bpc" id="L154" title="1 of 4 branches missed.">			if(order!=null&amp;&amp;all_orders.contains(order))</span>
<span class="fc" id="L155">				order.setStatus(cancel);</span>
	        }
<span class="fc" id="L157">		}</span>
	
	//View order report
	@Override
	public OrderReport viewOrderReport(String oid) {
<span class="nc" id="L162">		Order o = viewById(oid);</span>
<span class="nc" id="L163">		OrderReport oreport = new OrderReport(o);</span>
<span class="nc" id="L164">		return oreport;</span>
	}
	
	//View all orders
	public ArrayList&lt;Order&gt; viewAllOrders(){
<span class="fc" id="L169">		return orders;</span>
	}
	
	//View all customers
	public ArrayList&lt;Customer&gt; viewAllCustomers(){
<span class="fc" id="L174">		return customers;</span>
	}
	@Override
	public void setNull(){
<span class="fc" id="L178">		customers.clear();</span>
<span class="fc" id="L179">		orders.clear();</span>
<span class="fc" id="L180">		atomicInteger.set(0);</span>
<span class="fc" id="L181">		orderAtomicInteger.set(0);</span>
<span class="fc" id="L182">	}</span>
	
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.1.201405082137</span></div></body></html>